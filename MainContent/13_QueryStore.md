---
sort: 13
comments: true
---

# 쿼리 저장소

쿼리 저장소는 원래 2015년에 Azure SQL Database에 처음 소개되었으며 SQL Server에는 2016버전에 추가되었다.

쿼리 저장소는 세 가지 주요한 기능을 제공한다.  
    1. 쿼리의 성능수치와 실행 계획 등을 데이터베이스의 별도 저장공간에 영구적으로 저장하며 여러 유연한 방식으로 가져와 쉽게 성능 정보를 확인 할 수 있다.
    2. 쿼리 저장소는 실행 계획 동작을 직접 제어할수 있게 하는데 이전에는 매우 어렵게 수행했어야 하지만 매우 쉽게 가능하도록 하였다.
    3. 쿼리 저장소는 데이터베이스 업그레이드 시 시스템을 보호할 수 있는 위한 새로운 안전하며 보고기능이 있는 방식을 사용하여 쉽게 파악할 수 있도록 한다.

다음과 같은 것을 설명한다.

    - 쿼리 저장소의 작동 방식 및 수집하는 정보 
    - 쿼리 저장소 동작에 대해 Management Studio를 통해 노출되는 보고서 및 메커니즘 - 실행계획 적용, SQL Server 및 Azure SQL 데이터베이스에서 사용되는 실행 계획을 제어하는 방법
    - 다음을 지원하는 업그레이드 방법 시스템 동작 보호

확장 이벤트 세션은 정밀도를 측정하기 위한 수단이지만 대부분의 시스템에서 쿼리 저장소는 쿼리 성능을 모니터링하는 주요 수단이어야 합니다.

## <font color='dodgerblue' size="6">13.1 쿼리 저장소 함수와 디자인</font>

쿼리 저장소는 시스템에 미치는 영향 측면에서 아마도 가장 가벼운 메커니즘일 것입니다. 시스템의 쿼리 성능을 제대로 이해하는 데 필요한 핵심을 제공합니다. 또한 쿼리 저장소에 대한 모든 작업은 시스템 보기에서 수행되기 때문에 T-SQL을 사용하여 작업할 수 있으므로 사용이 매우 쉬워집니다. 쿼리 메트릭을 모니터링하기 위한 메커니즘으로 DMO, 추적 이벤트 및 어느 정도 확장 이벤트를 사용하는 것은 쿼리 저장소의 도입으로 구식으로 간주될 수 있습니다.

- ### a. 쿼리 저장소 활동
쿼리 저장소는 두 가지 정보를 수집합니다. 첫째, 시스템에서 각 쿼리 동작의 집계를 수집합니다. 둘째, 쿼리 저장소는 기본적으로 쿼리당 최대 계획 수(기본적으로 200개)까지 시스템에서 생성된 모든 실행 계획을 캡처합니다. 데이터베이스별로 쿼리 저장소를 켜고 끌 수 있습니다. 켜져 있으면 쿼리 저장소가 그림 13-1과 같이 작동합니다.

    ![XE시작화면](image/13/QueryStoreCollectionData01.png)  

    